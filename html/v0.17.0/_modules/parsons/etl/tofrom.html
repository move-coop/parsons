

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>parsons.etl.tofrom &mdash; Parsons 0.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=db78e746"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Parsons
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../action_kit.html">ActionKit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../action_network.html">Action Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../airtable.html">Airtable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../alchemer.html">Alchemer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../aws.html">Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../azure.html">Azure: Blob Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bill_com.html">Bill.com</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bloomerang.html">Bloomerang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../box.html">Box</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../braintree.html">Braintree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../civis.html">Civis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copper.html">Copper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crowdtangle.html">CrowdTangle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../facebook_ads.html">FacebookAds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../freshdesk.html">Freshdesk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../github.html">GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../google.html">Google</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hustle.html">Hustle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mailchimp.html">Mailchimp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobilize_america.html">Mobilize America</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../newmode.html">New/Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ngpvan.html">NGPVAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pdi.html">PDI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../p2a.html">Phone2Action</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../redash.html">Redash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rockthevote.html">Rock the Vote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../salesforce.html">Salesforce</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sftp.html">SFTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sisense.html">Sisense</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../targetsmart.html">TargetSmart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../turbovote.html">TurboVote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../twilio.html">Twilio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zoom.html">Zoom</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Enhancements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../census_geocoder.html">US Census Geocoder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Framework</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../dbsync.html">Database Sync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../table.html">Parsons Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities.html">Utilities</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributor Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing to Parsons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build_a_connector.html">How to Build a Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../write_tests.html">How to Write Tests for Parsons Connectors</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Parsons</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">parsons.etl.tofrom</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for parsons.etl.tofrom</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">petl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">parsons.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">files</span><span class="p">,</span> <span class="n">zip_archive</span>


<div class="viewcode-block" id="ToFrom">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToFrom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="ToFrom.to_dataframe">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_dataframe">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">coerce_float</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Outputs table as a Pandas Dataframe</span>

<span class="sd">        `Args:`</span>
<span class="sd">            index: str, list</span>
<span class="sd">                Field of array to use as the index, alternately a specific set</span>
<span class="sd">                of input labels to use</span>
<span class="sd">            exclude: list</span>
<span class="sd">                Columns or fields to exclude</span>
<span class="sd">            columns: list</span>
<span class="sd">                Column names to use. If the passed data do not have names</span>
<span class="sd">                associated with them, this argument provides names for the</span>
<span class="sd">                columns. Otherwise this argument indicates the order of the</span>
<span class="sd">                columns in the result (any names not found in the data will</span>
<span class="sd">                become all-NA columns)</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            dataframe</span>
<span class="sd">                Pandas DataFrame object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">petl</span><span class="o">.</span><span class="n">todataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                                <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.to_html">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_html">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span>
                <span class="n">index_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tr_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">td_styles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Outputs table to html.</span>

<span class="sd">        .. warning::</span>
<span class="sd">                If a file already exists at the given location, it will be</span>
<span class="sd">                overwritten.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: str</span>
<span class="sd">                The path to write the html locally. If not specified, a temporary file will be</span>
<span class="sd">                created and returned, and that file will be removed automatically when the script</span>
<span class="sd">                is done running.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            index_header: boolean</span>
<span class="sd">                Prepend index to column names; Defaults to False.</span>
<span class="sd">            caption: str</span>
<span class="sd">                A caption to include with the html table.</span>
<span class="sd">            tr_style: str or callable</span>
<span class="sd">                Style to be applied to the table row.</span>
<span class="sd">            td_styles: str, dict or callable</span>
<span class="sd">                Styles to be applied to the table cells.</span>
<span class="sd">            truncate: int</span>
<span class="sd">                Length of cell data.</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            str</span>
<span class="sd">                The path of the new file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_path</span><span class="p">:</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">create_temp_file</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.html&quot;</span><span class="p">)</span>

        <span class="n">petl</span><span class="o">.</span><span class="n">tohtml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
                    <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                    <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                    <span class="n">caption</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span>
                    <span class="n">index_header</span><span class="o">=</span><span class="n">index_header</span><span class="p">,</span>
                    <span class="n">tr_style</span><span class="o">=</span><span class="n">tr_style</span><span class="p">,</span>
                    <span class="n">td_styles</span><span class="o">=</span><span class="n">td_styles</span><span class="p">,</span>
                    <span class="n">truncate</span><span class="o">=</span><span class="n">truncate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">local_path</span></div>


<div class="viewcode-block" id="ToFrom.to_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_file_compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span>
               <span class="n">write_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">csv_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Outputs table to a CSV. Additional key word arguments are passed to ``csv.writer()``. So,</span>
<span class="sd">        e.g., to override the delimiter from the default CSV dialect, provide the delimiter</span>
<span class="sd">        keyword argument.</span>

<span class="sd">        .. warning::</span>
<span class="sd">                If a file already exists at the given location, it will be</span>
<span class="sd">                overwritten.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: str</span>
<span class="sd">                The path to write the csv locally. If it ends in &quot;.gz&quot; or &quot;.zip&quot;, the file will be</span>
<span class="sd">                compressed. If not specified, a temporary file will be created and returned,</span>
<span class="sd">                and that file will be removed automatically when the script is done running.</span>
<span class="sd">            temp_file_compression: str</span>
<span class="sd">                If a temp file is requested (ie. no ``local_path`` is specified), the compression</span>
<span class="sd">                type for that file. Currently &quot;None&quot;, &quot;gzip&quot; or &quot;zip&quot; are supported.</span>
<span class="sd">                If a ``local_path`` is specified, this argument is ignored.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            write_header: boolean</span>
<span class="sd">                Include header in output</span>
<span class="sd">            csv_name: str</span>
<span class="sd">                If ``zip`` compression (either specified or inferred), the name of csv file</span>
<span class="sd">                within the archive.</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            str</span>
<span class="sd">                The path of the new file</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="c1"># If a zip archive.</span>
        <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">zip_check</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">temp_file_compression</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_zip_csv</span><span class="p">(</span><span class="n">archive_path</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
                                   <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                                   <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                                   <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span>
                                   <span class="n">csv_name</span><span class="o">=</span><span class="n">csv_name</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_path</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;.csv&#39;</span> <span class="o">+</span> <span class="n">files</span><span class="o">.</span><span class="n">suffix_for_compression_type</span><span class="p">(</span><span class="n">temp_file_compression</span><span class="p">)</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">create_temp_file</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>

        <span class="c1"># Create normal csv/.gzip</span>
        <span class="n">petl</span><span class="o">.</span><span class="n">tocsv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                   <span class="n">source</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
                   <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                   <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                   <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">local_path</span></div>


<div class="viewcode-block" id="ToFrom.append_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.append_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">append_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends table to an existing CSV.</span>

<span class="sd">        Additional additional key word arguments</span>
<span class="sd">        are passed to ``csv.writer()``. So, e.g., to override the delimiter</span>
<span class="sd">        from the default CSV dialect, provide the delimiter keyword argument.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: str</span>
<span class="sd">                The local path of an existing CSV file. If it ends in &quot;.gz&quot;, the file will</span>
<span class="sd">                be compressed.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            str</span>
<span class="sd">                The path of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="n">petl</span><span class="o">.</span><span class="n">appendcsv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                       <span class="n">source</span><span class="o">=</span><span class="n">local_path</span><span class="p">,</span>
                       <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                       <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">local_path</span></div>


<div class="viewcode-block" id="ToFrom.to_zip_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_zip_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_zip_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csv_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Outputs table to a CSV in a zip archive. Additional key word arguments are passed to</span>
<span class="sd">        ``csv.writer()``. So, e.g., to override the delimiter from the default CSV dialect,</span>
<span class="sd">        provide the delimiter keyword argument. Use thismethod if you would like to write</span>
<span class="sd">        multiple csv files to the same archive.</span>

<span class="sd">        .. warning::</span>
<span class="sd">                If a file already exists in the archive, it will be overwritten.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            archive_path: str</span>
<span class="sd">                The path to zip achive. If not specified, a temporary file will be created and</span>
<span class="sd">                returned, and that file will be removed automatically when the script is done</span>
<span class="sd">                running.</span>
<span class="sd">            csv_name: str</span>
<span class="sd">                The name of the csv file to be stored in the archive. If ``None`` will use</span>
<span class="sd">                the archive name.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            write_header: boolean</span>
<span class="sd">                Include header in output</span>
<span class="sd">            if_exists: str</span>
<span class="sd">                If archive already exists, one of &#39;replace&#39; or &#39;append&#39;</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            str</span>
<span class="sd">                The path of the archive</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">archive_path</span><span class="p">:</span>
            <span class="n">archive_path</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">create_temp_file</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span>

        <span class="n">cf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_name</span><span class="p">:</span>
            <span class="n">csv_name</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">extract_file_name</span><span class="p">(</span><span class="n">archive_path</span><span class="p">,</span> <span class="n">include_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="k">return</span> <span class="n">zip_archive</span><span class="o">.</span><span class="n">create_archive</span><span class="p">(</span><span class="n">archive_path</span><span class="p">,</span> <span class="n">cf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">csv_name</span><span class="p">,</span>
                                          <span class="n">if_exists</span><span class="o">=</span><span class="n">if_exists</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.to_json">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_json">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_file_compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_delimited</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Outputs table to a JSON file</span>

<span class="sd">        .. warning::</span>
<span class="sd">                If a file already exists at the given location, it will be</span>
<span class="sd">                overwritten.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: str</span>
<span class="sd">                The path to write the JSON locally. If it ends in &quot;.gz&quot;, it will be</span>
<span class="sd">                compressed first. If not specified, a temporary file will be created and returned,</span>
<span class="sd">                and that file will be removed automatically when the script is done running.</span>
<span class="sd">            temp_file_compression: str</span>
<span class="sd">                If a temp file is requested (ie. no ``local_path`` is specified), the compression</span>
<span class="sd">                type for that file. Currently &quot;None&quot; and &quot;gzip&quot; are supported.</span>
<span class="sd">                If a ``local_path`` is specified, this argument is ignored.</span>
<span class="sd">            line_delimited: bool</span>
<span class="sd">                Whether the file will be line-delimited JSON (with a row on each line), or a proper</span>
<span class="sd">                JSON file.</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            str</span>
<span class="sd">                The path of the new file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_path</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;.json&#39;</span> <span class="o">+</span> <span class="n">files</span><span class="o">.</span><span class="n">suffix_for_compression_type</span><span class="p">(</span><span class="n">temp_file_compression</span><span class="p">)</span>
            <span class="n">local_path</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">create_temp_file</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>

        <span class="c1"># Note we don&#39;t use the much simpler petl.tojson(), since that method reads the whole</span>
        <span class="c1"># table into memory before writing to file.</span>

        <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">is_gzip_path</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="n">open_fn</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w+t&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">open_fn</span> <span class="o">=</span> <span class="nb">open</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>

        <span class="k">with</span> <span class="n">open_fn</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line_delimited</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line_delimited</span><span class="p">:</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">line_delimited</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">local_path</span></div>


<div class="viewcode-block" id="ToFrom.to_dicts">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_dicts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output table as a list of dicts.</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.to_sftp_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_sftp_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_sftp_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">rsa_private_key_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the table to a CSV file on a remote SFTP server</span>

<span class="sd">        `Args:`</span>
<span class="sd">            remote_path: str</span>
<span class="sd">                The remote path of the file. If it ends in &#39;.gz&#39;, the file will be compressed.</span>
<span class="sd">            host: str</span>
<span class="sd">                The remote host</span>
<span class="sd">            username: str</span>
<span class="sd">                The username to access the SFTP server</span>
<span class="sd">            password: str</span>
<span class="sd">                The password to access the SFTP server</span>
<span class="sd">            port: int</span>
<span class="sd">                The port number of the SFTP server</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            write_header: boolean</span>
<span class="sd">                Include header in output</span>
<span class="sd">            rsa_private_key_file str</span>
<span class="sd">                Absolute path to a private RSA key used</span>
<span class="sd">                to authenticate stfp connection</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.sftp</span><span class="w"> </span><span class="kn">import</span> <span class="n">SFTP</span>

        <span class="n">sftp</span> <span class="o">=</span> <span class="n">SFTP</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">rsa_private_key_file</span><span class="p">)</span>

        <span class="n">compression</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">compression_type_for_path</span><span class="p">(</span><span class="n">remote_path</span><span class="p">)</span>

        <span class="n">local_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
            <span class="n">temp_file_compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
            <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>
        <span class="n">sftp</span><span class="o">.</span><span class="n">put_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">remote_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.to_s3_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_s3_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_s3_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">aws_access_key_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">acl</span><span class="o">=</span><span class="s1">&#39;bucket-owner-full-control&#39;</span><span class="p">,</span>
                  <span class="n">public_url</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">public_url_expires</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the table to an s3 object as a CSV</span>

<span class="sd">        `Args:`</span>
<span class="sd">            bucket: str</span>
<span class="sd">                The s3 bucket to upload to</span>
<span class="sd">            key: str</span>
<span class="sd">                The s3 key to name the file. If it ends in &#39;.gz&#39; or &#39;.zip&#39;, the file will be</span>
<span class="sd">                compressed.</span>
<span class="sd">            aws_access_key_id: str</span>
<span class="sd">                Required if not included as environmental variable</span>
<span class="sd">            aws_secret_access_key: str</span>
<span class="sd">                Required if not included as environmental variable</span>
<span class="sd">            compression: str</span>
<span class="sd">                The compression type for the s3 object. Currently &quot;None&quot;, &quot;zip&quot; and &quot;gzip&quot; are</span>
<span class="sd">                supported. If specified, will override the key suffix.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            write_header: boolean</span>
<span class="sd">                Include header in output</span>
<span class="sd">            public_url: boolean</span>
<span class="sd">                Create a public link to the file</span>
<span class="sd">            public_url_expire: 3600</span>
<span class="sd">                The time, in seconds, until the url expires if ``public_url`` set to ``True``.</span>
<span class="sd">            acl: str</span>
<span class="sd">                The S3 permissions on the file</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Public url if specified. If not ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span> <span class="ow">or</span> <span class="n">files</span><span class="o">.</span><span class="n">compression_type_for_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">csv_name</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">extract_file_name</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">include_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="c1"># Save the CSV as a temp file</span>
        <span class="n">local_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp_file_compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
                                 <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                                 <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span>
                                 <span class="n">csv_name</span><span class="o">=</span><span class="n">csv_name</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>

        <span class="c1"># Put the file on S3</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.aws</span><span class="w"> </span><span class="kn">import</span> <span class="n">S3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">S3</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">aws_access_key_id</span><span class="p">,</span>
                     <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">aws_secret_access_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">put_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">acl</span><span class="o">=</span><span class="n">acl</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">public_url</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expires_in</span><span class="o">=</span><span class="n">public_url_expires</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ToFrom.to_gcs_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_gcs_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_gcs_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">,</span> <span class="n">app_creds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">write_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">public_url</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">public_url_expires</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the table to a Google Cloud Storage blob as a CSV.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            bucket_name: str</span>
<span class="sd">                The bucket to upload to</span>
<span class="sd">            blob_name: str</span>
<span class="sd">                The blob to name the file. If it ends in &#39;.gz&#39; or &#39;.zip&#39;, the file will be</span>
<span class="sd">                compressed.</span>
<span class="sd">            app_creds: str</span>
<span class="sd">                A credentials json string or a path to a json file. Not required</span>
<span class="sd">                if ``GOOGLE_APPLICATION_CREDENTIALS`` env variable set.</span>
<span class="sd">            project: str</span>
<span class="sd">                The project which the client is acting on behalf of. If not passed</span>
<span class="sd">                then will use the default inferred environment.</span>
<span class="sd">            compression: str</span>
<span class="sd">                The compression type for the csv. Currently &quot;None&quot;, &quot;zip&quot; and &quot;gzip&quot; are</span>
<span class="sd">                supported. If specified, will override the key suffix.</span>
<span class="sd">            encoding: str</span>
<span class="sd">                The CSV encoding type for `csv.writer()</span>
<span class="sd">                &lt;https://docs.python.org/2/library/csv.html#csv.writer/&gt;`_</span>
<span class="sd">            errors: str</span>
<span class="sd">                Raise an Error if encountered</span>
<span class="sd">            write_header: boolean</span>
<span class="sd">                Include header in output</span>
<span class="sd">            public_url: boolean</span>
<span class="sd">                Create a public link to the file</span>
<span class="sd">            public_url_expire: 60</span>
<span class="sd">                The time, in minutes, until the url expires if ``public_url`` set to ``True``.</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_writer`` optional arguments</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Public url if specified. If not ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span> <span class="ow">or</span> <span class="n">files</span><span class="o">.</span><span class="n">compression_type_for_path</span><span class="p">(</span><span class="n">blob_name</span><span class="p">)</span>

        <span class="n">csv_name</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">extract_file_name</span><span class="p">(</span><span class="n">blob_name</span><span class="p">,</span> <span class="n">include_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="c1"># Save the CSV as a temp file</span>
        <span class="n">local_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp_file_compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
                                 <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                                 <span class="n">write_header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span>
                                 <span class="n">csv_name</span><span class="o">=</span><span class="n">csv_name</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">csvargs</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.google.google_cloud_storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">GoogleCloudStorage</span>
        <span class="n">gcs</span> <span class="o">=</span> <span class="n">GoogleCloudStorage</span><span class="p">(</span><span class="n">app_creds</span><span class="o">=</span><span class="n">app_creds</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>
        <span class="n">gcs</span><span class="o">.</span><span class="n">put_blob</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">,</span> <span class="n">local_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">public_url</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gcs</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">,</span> <span class="n">expires_in</span><span class="o">=</span><span class="n">public_url_expires</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ToFrom.to_redshift">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_redshift">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">copy_args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a table to a Redshift database. Note, this requires you to pass</span>
<span class="sd">        AWS S3 credentials or store them as environmental variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: str</span>
<span class="sd">                The table name and schema (``my_schema.my_table``) to point the file.</span>
<span class="sd">            username: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_USERNAME`` not populated</span>
<span class="sd">            password: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_PASSWORD`` not populated</span>
<span class="sd">            host: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_HOST`` not populated</span>
<span class="sd">            db: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_DB`` not populated</span>
<span class="sd">            port: int</span>
<span class="sd">                Required if env variable ``REDSHIFT_PORT`` not populated. Port 5439 is typical.</span>
<span class="sd">            \**copy_args: kwargs</span>
<span class="sd">                See :func:`~parsons.databases.Redshift.copy`` for options.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.databases.redshift</span><span class="w"> </span><span class="kn">import</span> <span class="n">Redshift</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">Redshift</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="o">**</span><span class="n">copy_args</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.to_postgres">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_postgres">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_postgres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">copy_args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a table to a Postgres database.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: str</span>
<span class="sd">                The table name and schema (``my_schema.my_table``) to point the file.</span>
<span class="sd">            username: str</span>
<span class="sd">                Required if env variable ``PGUSER`` not populated</span>
<span class="sd">            password: str</span>
<span class="sd">                Required if env variable ``PGPASSWORD`` not populated</span>
<span class="sd">            host: str</span>
<span class="sd">                Required if env variable ``PGHOST`` not populated</span>
<span class="sd">            db: str</span>
<span class="sd">                Required if env variable ``PGDATABASE`` not populated</span>
<span class="sd">            port: int</span>
<span class="sd">                Required if env variable ``PGPORT`` not populated.</span>
<span class="sd">            \**copy_args: kwargs</span>
<span class="sd">                See :func:`~parsons.databases.Postgres.copy`` for options.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``None``</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.databases.postgres</span><span class="w"> </span><span class="kn">import</span> <span class="n">Postgres</span>
        <span class="n">pg</span> <span class="o">=</span> <span class="n">Postgres</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="n">pg</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="o">**</span><span class="n">copy_args</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">to_petl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>

<div class="viewcode-block" id="ToFrom.to_civis">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.to_civis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_civis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">existing_table_rows</span><span class="o">=</span><span class="s1">&#39;fail&#39;</span><span class="p">,</span> <span class="n">diststyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sortkey1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sortkey2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">civisargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the table to a Civis Redshift cluster. Additional key word</span>
<span class="sd">        arguments can passed to `civis.io.dataframe_to_civis()</span>
<span class="sd">        &lt;https://civis-python.readthedocs.io/en/v1.9.0/generated/civis.io.dataframe_to_civis.html#civis.io.dataframe_to_civis&gt;`_ # noqa: E501</span>

<span class="sd">        `Args`</span>
<span class="sd">            table: str</span>
<span class="sd">                The schema and table you want to upload to. E.g.,</span>
<span class="sd">                &#39;scratch.table&#39;. Schemas or tablenames with periods must be</span>
<span class="sd">                double quoted, e.g. &#39;scratch.&quot;my.table&quot;&#39;.</span>
<span class="sd">            api_key: str</span>
<span class="sd">                Your Civis API key. If not given, the CIVIS_API_KEY environment</span>
<span class="sd">                variable will be used.</span>
<span class="sd">            db: str or int</span>
<span class="sd">                The Civis Database. Can be database name or ID</span>
<span class="sd">            max_errors: int</span>
<span class="sd">                The maximum number of rows with errors to remove from</span>
<span class="sd">                the import before failing.</span>
<span class="sd">            diststyle: str</span>
<span class="sd">                The distribution style for the table. One of `&#39;even&#39;`, `&#39;all&#39;`</span>
<span class="sd">                or `&#39;key&#39;`.</span>
<span class="sd">            existing_table_rows: str</span>
<span class="sd">                The behaviour if a table with the requested name already</span>
<span class="sd">                exists. One of `&#39;fail&#39;`, `&#39;truncate&#39;`, `&#39;append&#39;` or `&#39;drop&#39;`.</span>
<span class="sd">                Defaults to `&#39;fail&#39;`.</span>
<span class="sd">            distkey: str</span>
<span class="sd">                The column to use as the distkey for the table.</span>
<span class="sd">            sortkey1: str</span>
<span class="sd">                The column to use as the sortkey for the table.</span>
<span class="sd">            sortkey2: str</span>
<span class="sd">                The second column in a compound sortkey for the table.</span>
<span class="sd">            wait: boolean</span>
<span class="sd">                Wait for write job to complete before exiting method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.civis.civisclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">CivisClient</span>
        <span class="n">civis</span> <span class="o">=</span> <span class="n">CivisClient</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">civis</span><span class="o">.</span><span class="n">table_import</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">max_errors</span><span class="o">=</span><span class="n">max_errors</span><span class="p">,</span>
            <span class="n">existing_table_rows</span><span class="o">=</span><span class="n">existing_table_rows</span><span class="p">,</span> <span class="n">diststyle</span><span class="o">=</span><span class="n">diststyle</span><span class="p">,</span>
            <span class="n">distkey</span><span class="o">=</span><span class="n">distkey</span><span class="p">,</span> <span class="n">sortkey1</span><span class="o">=</span><span class="n">sortkey1</span><span class="p">,</span> <span class="n">sortkey2</span><span class="o">=</span><span class="n">sortkey2</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">,</span>
            <span class="o">**</span><span class="n">civisargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.from_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_csv">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` object from a CSV file</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: obj</span>
<span class="sd">                A csv formatted local path, url or ftp. If this is a</span>
<span class="sd">                file path that ends in &quot;.gz&quot;, the file will be decompressed first.</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_reader`` optional arguments</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Parsons Table</span>
<span class="sd">                See :ref:`parsons-table` for output options.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="n">remote_prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="s2">&quot;ftp://&quot;</span><span class="p">,</span> <span class="s2">&quot;s3://&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">local_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">,</span> <span class="n">remote_prefixes</span><span class="p">)):</span>
            <span class="n">is_remote_file</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_remote_file</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_remote_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">files</span><span class="o">.</span><span class="n">has_data</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;CSV file is empty&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromcsv</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.from_csv_string">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_csv_string">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_csv_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` object from a string representing a CSV.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            str: str</span>
<span class="sd">                The string object to convert to a table</span>
<span class="sd">            **csvargs: kwargs</span>
<span class="sd">                ``csv_reader`` optional arguments</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Parsons Table</span>
<span class="sd">                See :ref:`parsons-table` for output options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bytesio</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">memory_source</span> <span class="o">=</span> <span class="n">petl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">MemorySource</span><span class="p">(</span><span class="n">bytesio</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromcsv</span><span class="p">(</span><span class="n">memory_source</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.from_columns">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_columns">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_columns</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` from a list of lists organized as columns</span>

<span class="sd">        `Args:`</span>
<span class="sd">            cols: list</span>
<span class="sd">                A list of lists organized as columns</span>
<span class="sd">            header: list</span>
<span class="sd">                List of column names. If not specified, will use dummy column names</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Parsons Table</span>
<span class="sd">                See :ref:`parsons-table` for output options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromcolumns</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.from_json">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_delimited</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` from a json file</span>

<span class="sd">        `Args:`</span>
<span class="sd">            local_path: list</span>
<span class="sd">                A JSON formatted local path, url or ftp. If this is a</span>
<span class="sd">                file path that ends in &quot;.gz&quot;, the file will be decompressed first.</span>
<span class="sd">            header: list</span>
<span class="sd">                List of columns to use for the destination table. If omitted, columns will</span>
<span class="sd">                be inferred from the initial data in the file.</span>
<span class="sd">            line_delimited: bool</span>
<span class="sd">                Whether the file is line-delimited JSON (with a row on each line), or a proper</span>
<span class="sd">                JSON file.</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            Parsons Table</span>
<span class="sd">                See :ref:`parsons-table` for output options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">line_delimited</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">is_gzip_path</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
                <span class="n">open_fn</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">open_fn</span> <span class="o">=</span> <span class="nb">open</span>

            <span class="k">with</span> <span class="n">open_fn</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromjson</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.from_redshift">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_redshift">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_redshift</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` from a Redshift query.</span>

<span class="sd">        To pull an entire Redshift table, use a query like ``SELECT * FROM tablename``.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            sql: str</span>
<span class="sd">                A valid SQL statement</span>
<span class="sd">            username: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_USERNAME`` not populated</span>
<span class="sd">            password: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_PASSWORD`` not populated</span>
<span class="sd">            host: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_HOST`` not populated</span>
<span class="sd">            db: str</span>
<span class="sd">                Required if env variable ``REDSHIFT_DB`` not populated</span>
<span class="sd">            port: int</span>
<span class="sd">                Required if env variable ``REDSHIFT_PORT`` not populated. Port 5439 is typical.</span>

<span class="sd">        `Returns:`</span>
<span class="sd">            Parsons Table</span>
<span class="sd">                See :ref:`parsons-table` for output options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.databases.redshift</span><span class="w"> </span><span class="kn">import</span> <span class="n">Redshift</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">Redshift</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.from_postgres">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_postgres">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_postgres</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            sql: str</span>
<span class="sd">                A valid SQL statement</span>
<span class="sd">            username: str</span>
<span class="sd">                Required if env variable ``PGUSER`` not populated</span>
<span class="sd">            password: str</span>
<span class="sd">                Required if env variable ``PGPASSWORD`` not populated</span>
<span class="sd">            host: str</span>
<span class="sd">                Required if env variable ``PGHOST`` not populated</span>
<span class="sd">            db: str</span>
<span class="sd">                Required if env variable ``PGDATABASE`` not populated</span>
<span class="sd">            port: int</span>
<span class="sd">                Required if env variable ``PGPORT`` not populated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.databases.postgres</span><span class="w"> </span><span class="kn">import</span> <span class="n">Postgres</span>
        <span class="n">pg</span> <span class="o">=</span> <span class="n">Postgres</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToFrom.from_s3_csv">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_s3_csv">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_s3_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">from_manifest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aws_access_key_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` from a key in an S3 bucket.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            bucket: str</span>
<span class="sd">                The S3 bucket.</span>
<span class="sd">            key: str</span>
<span class="sd">                The S3 key</span>
<span class="sd">            from_manifest: bool</span>
<span class="sd">                If True, treats `key` as a manifest file and loads all urls into a `parsons.Table`.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            aws_access_key_id: str</span>
<span class="sd">                Required if not included as environmental variable.</span>
<span class="sd">            aws_secret_access_key: str</span>
<span class="sd">                Required if not included as environmental variable.</span>
<span class="sd">            \**csvargs: kwargs</span>
<span class="sd">                ``csv_reader`` optional arguments</span>
<span class="sd">        `Returns:`</span>
<span class="sd">            `parsons.Table` object</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W605</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">parsons.aws</span><span class="w"> </span><span class="kn">import</span> <span class="n">S3</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">S3</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="p">,</span> <span class="n">aws_secret_access_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_manifest</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">s3</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">manifest</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

            <span class="n">s3_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">s3_keys</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="n">tbls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">s3_keys</span><span class="p">:</span>
            <span class="c1"># TODO handle urls that end with &#39;/&#39;, i.e. urls that point to &quot;folders&quot;</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bucket_</span><span class="p">,</span> <span class="n">key_</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">file_</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="n">bucket_</span><span class="p">,</span> <span class="n">key_</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">compression_type_for_path</span><span class="p">(</span><span class="n">key_</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;zip&#39;</span><span class="p">:</span>
                <span class="n">file_</span> <span class="o">=</span> <span class="n">zip_archive</span><span class="o">.</span><span class="n">unzip_archive</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>

            <span class="n">tbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromcsv</span><span class="p">(</span><span class="n">file_</span><span class="p">,</span> <span class="o">**</span><span class="n">csvargs</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="o">*</span><span class="n">tbls</span><span class="p">))</span></div>


<div class="viewcode-block" id="ToFrom.from_dataframe">
<a class="viewcode-back" href="../../../table.html#parsons.etl.tofrom.ToFrom.from_dataframe">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dataframe</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">,</span> <span class="n">include_index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a ``parsons table`` from a Pandas dataframe.</span>

<span class="sd">        `Args:`</span>
<span class="sd">            dataframe: dataframe</span>
<span class="sd">                A valid Pandas dataframe objectt</span>
<span class="sd">            include_index: boolean</span>
<span class="sd">                Include index column</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">petl</span><span class="o">.</span><span class="n">fromdataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">include_index</span><span class="o">=</span><span class="n">include_index</span><span class="p">))</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The Movement Cooperative.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v0.17.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Most Common</dt>
        <!-- Show latest & stable first -->
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                  <dd><a href="../../../../latest/index.html">latest</a></dd>
            
        
            
                  <dd><a href="../../../../stable/index.html">stable</a></dd>
            
        

        <dt>By Version Number</dt>
        <!-- Show other versions -->
        
            
                  <dd><a href="../../../../v0.14.0/index.html">v0.14.0</a></dd>
            
        
            
                  <dd><a href="../../../../v0.15.0/index.html">v0.15.0</a></dd>
            
        
            
                  <dd><a href="../../../../v0.16.0/index.html">v0.16.0</a></dd>
            
        
            
                  <dd><a href="tofrom.html">v0.17.0</a></dd>
            
        
            
                  <dd><a href="../../../../v0.18.0/index.html">v0.18.0</a></dd>
            
        
            
                  <dd><a href="../../../../v0.18.1/index.html">v0.18.1</a></dd>
            
        
            
        
            
        

      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>